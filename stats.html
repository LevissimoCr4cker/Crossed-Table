<h1>Weighted School Ranking</h1>

<h3>Add Your Own School (51st)</h3>
<div class="input-box" id="customInputs">
  <input type="text" id="schoolName" placeholder="School Name">
  <input type="number" min="1" max="5" placeholder="Scholarship" id="scholarship">
  <input type="number" min="1" max="5" placeholder="academic" id="academic">
  <input type="number" min="1" max="5" placeholder="employment" id="employment">
  <input type="number" min="1" max="5" placeholder="innovation" id="innovation">
  <input type="number" min="1" max="5" placeholder="international" id="international">
  <input type="number" min="1" max="5" placeholder="research" id="research">
  <input type="number" min="1" max="5" placeholder="infrastructure" id="infrastructure">
  <input type="number" min="1" max="5" placeholder="sports" id="sports">
  <input type="number" min="1" max="5" placeholder="food" id="food">
  <input type="number" min="1" max="5" placeholder="environment" id="environment">
  <button class="btn" id="addSchool">Add</button>
</div>

<div id="results"></div>
<canvas id="rankingChart"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const weights = {
  Scholarship: 10,
  "Academic Quality": 9,
  "Employment Opportunities": 8,
  Innovation: 8,
  International: 2,
  Research: 7,
  Infrastructure: 8,
  Sports: 5,
  Food: 5,
  Environment: 10
};

let schools = [];
let chart = null;

// Parse CSV from server
async function loadCSV() {
  const response = await fetch("data.csv");
  const text = await response.text();
  const lines = text.trim().split("\n");
  const headers = lines[0].split(",");
  schools = lines.slice(1).map(line => {
    const values = line.split(",");
    const obj = {};
    headers.forEach((h,i) => {
      const key = h.trim();
      const value = values[i]?.trim();
      obj[key] = isNaN(value) ? value : Number(value);
    });
    return obj;
  });
  displayResults();
}

// Calculate weighted score
function calculateScore(school) {
  let total = 0, weightSum = 0;
  for (let key in weights) {
    if (school[key] !== undefined && !isNaN(school[key])) {
      total += school[key] * weights[key];
      weightSum += weights[key];
    }
  }
  return (total / weightSum) * 100;
}

// Display table & chart
function displayResults() {
  schools.forEach(s => s.Score = calculateScore(s));
  schools.sort((a,b) => b.Score - a.Score);

  // Table
  let html = `<h2>Ranking (${schools.length} Schools)</h2>
    <table><tr><th>Rank</th><th>School</th><th>Score</th></tr>`;
  schools.forEach((s,i) => {
    const highlight = s.School === "Custom School" ? "style='background:#d1f5d3;font-weight:bold;'" : "";
    html += `<tr ${highlight}><td>${i+1}</td><td>${s.School}</td><td>${s.Score.toFixed(2)}</td></tr>`;
  });
  html += "</table>";
  document.getElementById("results").innerHTML = html;

  // Chart
  const ctx = document.getElementById("rankingChart").getContext("2d");
  const labels = schools.map(s => s.School);
  const data = schools.map(s => s.Score);
  const colors = schools.map(s => s.School === "Custom School" ? "#4CAF50" : "#2196F3");

  if(chart) chart.destroy();
  chart = new Chart(ctx, {
    type: "bar",
    data: { labels, datasets: [{ label: "Weighted Score", data, backgroundColor: colors }] },
    options: {
      responsive:true,
      plugins:{ legend:{display:false}, title:{display:true,text:"School Ranking"} },
      scales:{ y:{beginAtZero:true, max:100}, x:{ticks:{callback:(v,i)=>labels[i].length>10?labels[i].slice(0,10)+'â€¦':labels[i]}}}
    }
  });
}

// Add 51st school
document.getElementById("addSchool").addEventListener("click", () => {
  const newSchool = {
    School: document.getElementById("schoolName").value || "Custom School",
    Scholarship: +document.getElementById("scholarship").value,
    "Academic Quality": +document.getElementById("academic").value,
    "Employment Opportunities": +document.getElementById("employment").value,
    Innovation: +document.getElementById("innovation").value,
    International: +document.getElementById("international").value,
    Research: +document.getElementById("research").value,
    Infrastructure: +document.getElementById("infrastructure").value,
    Sports: +document.getElementById("sports").value,
    Food: +document.getElementById("food").value,
    Environment: +document.getElementById("environment").value
  };
  schools.push(newSchool);
  displayResults();
});

// Initialize
loadCSV();

  <button class="btn" onclick="window.location.href='index.html'">Return</button>

</script>
