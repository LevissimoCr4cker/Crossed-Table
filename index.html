<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>School Analyzer</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Arial', sans-serif;
    }

    body {
      background-color: #f0f4f8;
      color: #333;
    }

    header {
      background-color: #1e3a8a;
      color: white;
      text-align: center;
      padding: 1.5rem;
      font-size: 1.8rem;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .container {
      max-width: 800px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .criterion {
      display: flex;
      align-items: center;
      margin: 1rem 0;
      background-color: white;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .criterion label {
      flex: 1;
      font-weight: 600;
      color: #1e3a8a;
    }

    .stars {
      display: flex;
      gap: 0.3rem;
    }

    .star {
      font-size: 1.5rem;
      color: #d1d5db;
      cursor: pointer;
      transition: color 0.2s;
    }

    .star.filled {
      color: #3b82f6;
    }

    .star:hover {
      color: #2563eb;
    }

    .btn-container {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin: 1.5rem 0;
    }

    .btn {
      background-color: #3b82f6;
      color: white;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
      transition: background-color 0.2s;
    }

    .btn:hover {
      background-color: #2563eb;
    }

    .btn.secondary {
      background-color: #6b7280;
    }

    .btn.secondary:hover {
      background-color: #4b5563;
    }

    .btn.third {
      background-color: #4b5e8a;
    }

    .btn.third:hover {
      background-color: #3b4a6b;
    }

    .btn.four {
      background-color: #2c4a7e;
    }

    .btn.four:hover {
      background-color: #1e3a8a;
    }

    .btn.five {
      background-color: #1e40af;
    }

    .btn.five:hover {
      background-color: #1e3a8a;
    }

    .btn.retry-btn {
      background-color: #ef4444;
    }

    .btn.retry-btn:hover {
      background-color: #dc2626;
    }

    .results {
      max-width: 800px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .card {
      background-color: white;
      padding: 1.5rem;
      margin: 1rem 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .card h3 {
      color: #1e3a8a;
      margin-bottom: 1rem;
    }

    .card ul {
      list-style: none;
      margin: 0.5rem 0;
    }

    .card ul li {
      margin: 0.5rem 0;
      color: #374151;
    }

    .result-stars.mandatory {
      color: #dc2626;
      font-weight: bold;
    }

    .result-stars.four-star {
      color: #f59e0b;
    }

    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      border: 0;
    }

    /* Burger Menu */
    .burger-menu {
      position: relative;
      display: none;
    }

    .burger-icon {
      background-color: #3b82f6;
      color: white;
      padding: 0.75rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .burger-icon:hover {
      background-color: #2563eb;
    }

    .burger-menu-content {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      background-color: white;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      border-radius: 6px;
      overflow: hidden;
      z-index: 1000;
    }

    .burger-menu-content button {
      display: block;
      width: 100%;
      text-align: left;
      border: none;
      background: none;
      padding: 0.75rem 1.5rem;
      color: #1e3a8a;
      font-size: 1rem;
      cursor: pointer;
    }

    .burger-menu-content button:hover {
      background-color: #f0f4f8;
    }

    .burger-menu.active .burger-menu-content {
      display: block;
    }

    @media (max-width: 768px) {
      .btn-container {
        display: none;
      }

      .burger-menu {
        display: block;
        margin: 1rem auto;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <header>School Analyzer</header>
  <div class="container" id="criteria-container"></div>
  <div class="btn-container">
    <button id="findBtn" class="btn">Find Top Matches</button>
    <button id="statsBtn" class="btn secondary">View Classification Stats</button>
    <button id="graphBtn" class="btn third">View Graphs</button>
    <button id="apoBtn" class="btn four">View Statistiques</button>
    <button id="edcBtn" class="btn five">EDC</button>
  </div>
  <div class="burger-menu" id="burgerMenu">
    <div class="burger-icon" id="burgerIcon">â˜° Menu</div>
    <div class="burger-menu-content" id="burgerMenuContent">
      <button id="findBtnMobile" class="btn">Find Top Matches</button>
      <button id="statsBtnMobile" class="btn secondary">View Classification Stats</button>
      <button id="graphBtnMobile" class="btn third">View Graphs</button>
      <button id="apoBtnMobile" class="btn four">View Statistiques</button>
      <button id="edcBtnMobile" class="btn five">EDC</button>
    </div>
  </div>
  <div class="results" id="results"></div>

  <script>
    // Toggle burger menu
    const burgerIcon = document.getElementById('burgerIcon');
    const burgerMenu = document.getElementById('burgerMenu');
    burgerIcon.addEventListener('click', () => {
      burgerMenu.classList.toggle('active');
    });

    // Button event listeners (desktop)
    document.getElementById('statsBtn').addEventListener('click', () => {
      window.location.href = 'stats.html';
    });

    document.getElementById('graphBtn').addEventListener('click', () => {
      window.location.href = 'graph.html';
    });

    document.getElementById('apoBtn').addEventListener('click', () => {
      window.location.href = 'graphics.html';
    });

    document.getElementById('edcBtn').addEventListener('click', () => {
      window.location.href = 'edc.html';
    });

    // Button event listeners (mobile)
    document.getElementById('statsBtnMobile').addEventListener('click', () => {
      window.location.href = 'stats.html';
    });

    document.getElementById('graphBtnMobile').addEventListener('click', () => {
      window.location.href = 'graph.html';
    });

    document.getElementById('apoBtnMobile').addEventListener('click', () => {
      window.location.href = 'graphics.html';
    });

    document.getElementById('edcBtnMobile').addEventListener('click', () => {
      window.location.href = 'edc.html';
    });

    // Criteria
    const criteria = [
      "Scholarship Accessibility",
      "Academic Quality",
      "Employment Opportunities",
      "Innovation & Modern Programs",
      "International Environment",
      "Research Activity",
      "Infrastructure & IT Support",
      "Sports & Campus Life",
      "Food & Dining Facilities",
      "Campus Environment"
    ];

    // Fetch university data
    let universities = [];
    fetch('data/schools.json')
      .then(response => response.json())
      .then(data => {
        universities = data;
        initializeCriteria();
      })
      .catch(error => {
        console.error('Error fetching university data:', error);
        document.getElementById('results').innerHTML = "<p>Error loading university data. Please try again later.</p>";
      });

    // Generate star inputs
    function initializeCriteria() {
      const container = document.getElementById('criteria-container');
      criteria.forEach(c => {
        const div = document.createElement('div');
        div.className = 'criterion';
        div.innerHTML = `<label for="${c.replace(/\s+/g, '-')}-stars">${c}:</label><div class="stars" data-criterion="${c}" id="${c.replace(/\s+/g, '-')}-stars">
          <span class="star" data-value="1" role="button" aria-label="1 star for ${c}">&#9733;</span>
          <span class="star" data-value="2" role="button" aria-label="2 stars for ${c}">&#9733;</span>
          <span class="star" data-value="3" role="button" aria-label="3 stars for ${c}">&#9733;</span>
          <span class="star" data-value="4" role="button" aria-label="4 stars for ${c}">&#9733;</span>
          <span class="star" data-value="5" role="button" aria-label="5 stars for ${c}">&#9733;</span>
        </div>`;
        container.appendChild(div);
      });

      // Star click
      document.querySelectorAll('.stars').forEach(starContainer => {
        starContainer.addEventListener('click', e => {
          if (!e.target.classList.contains('star')) return;
          const val = parseInt(e.target.dataset.value);
          [...starContainer.children].forEach(star => {
            star.classList.toggle('filled', parseInt(star.dataset.value) <= val);
          });
        });
      });
    }

    // Find matches
    document.getElementById('findBtn').addEventListener('click', () => {
      handleFindMatches();
    });

    document.getElementById('findBtnMobile').addEventListener('click', () => {
      handleFindMatches();
      burgerMenu.classList.remove('active');
    });

    function handleFindMatches() {
      const userPrefs = {};
      document.querySelectorAll('.stars').forEach(container => {
        const crit = container.dataset.criterion;
        const filledStars = container.querySelectorAll('.star.filled').length;
        userPrefs[crit] = filledStars;
      });

      const mandatoryCriteria = criteria.filter(c => userPrefs[c] === 5);
      const fourStarCriteria = criteria.filter(c => userPrefs[c] === 4);
      const threeStarCriteria = criteria.filter(c => userPrefs[c] === 3);
      const twoStarCriteria = criteria.filter(c => userPrefs[c] === 2);
      const oneStarCriteria = criteria.filter(c => userPrefs[c] === 1);

      const filtered = universities
        .filter(u => {
          if (mandatoryCriteria.length === 0) return true;
          return mandatoryCriteria.every(c => u[c] === 5);
        })
        .map(u => {
          const fourStarScore = fourStarCriteria.reduce((sum, c) => sum + u[c], 0);
          const threeStarScore = threeStarCriteria.reduce((sum, c) => sum + u[c], 0);
          const twoStarScore = twoStarCriteria.reduce((sum, c) => sum + u[c], 0);
          const oneStarScore = oneStarCriteria.reduce((sum, c) => sum + u[c], 0);
          let score = 0;
          criteria.forEach(c => {
            if (userPrefs[c] !== 5) {
              score += 5 - Math.abs(u[c] - userPrefs[c]);
            }
          });
          return { ...u, fourStarScore, threeStarScore, twoStarScore, oneStarScore, score };
        })
        .sort((a, b) => {
          if (a.fourStarScore !== b.fourStarScore) return b.fourStarScore - a.fourStarScore;
          if (a.threeStarScore !== b.threeStarScore) return b.threeStarScore - a.threeStarScore;
          if (a.twoStarScore !== b.twoStarScore) return b.twoStarScore - a.twoStarScore;
          if (a.oneStarScore !== b.oneStarScore) return b.oneStarScore - a.oneStarScore;
          return b.score - a.score;
        });

      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = "";

      if (filtered.length === 0) {
        resultsDiv.innerHTML = "<p>No match found based on your 5-star preferences.</p>";
      } else {
        filtered.forEach(u => {
          const card = document.createElement('div');
          card.className = "card";
          let criteriaHTML = '<ul>';
          criteria.forEach(c => {
            const stars = 'â˜…'.repeat(u[c]) + 'â˜†'.repeat(5 - u[c]);
            criteriaHTML += `<li>${c}: <span class="result-stars${userPrefs[c] === 5 ? ' mandatory' : userPrefs[c] === 4 ? ' four-star' : ''}">${stars}</span><span class="sr-only"> (${u[c]} stars)</span></li>`;
          });
          criteriaHTML += '</ul>';
          card.innerHTML = `<h3>${u.School}</h3>${criteriaHTML}<p>Similarity Score: ${u.score} | 4-Star Priority Score: ${u.fourStarScore}</p>`;
          resultsDiv.appendChild(card);
        });
      }

      const retryBtn = document.createElement('button');
      retryBtn.textContent = "Retry";
      retryBtn.className = "btn retry-btn";
      retryBtn.setAttribute('aria-label', 'Retry selection');
      retryBtn.setAttribute('role', 'button');
      retryBtn.onclick = () => {
        document.querySelectorAll('.star').forEach(s => s.classList.remove('filled'));
        resultsDiv.innerHTML = "";
      };
      resultsDiv.appendChild(retryBtn);
    }
  </script>
</body>
</html>
