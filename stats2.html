<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üè´ Weighted School Ranking</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f6f6f8;
    margin: 40px;
  }
  h1 { text-align: center; }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 25px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: center;
  }
  th { background: #eee; }
  .input-box {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    margin-top: 10px;
  }
  .input-box input {
    width: 70px;
    padding: 5px;
  }
  .btn {
    padding: 8px 16px;
    background-color: #0078d7;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  .btn:hover { background-color: #005fa3; }
  canvas {
    margin-top: 40px;
    width: 100% !important;
    height: 400px !important;
  }
</style>
</head>
<body>

<h1>Weighted School Ranking</h1>

<h3>Add Your Own School (51st)</h3>
<div class="input-box" id="customInputs">
  <input type="text" id="schoolName" placeholder="School Name">
  <input type="number" min="1" max="5" placeholder="Scholarship" id="scholarship">
  <input type="number" min="1" max="5" placeholder="Academic" id="academic">
  <input type="number" min="1" max="5" placeholder="Employment" id="employment">
  <input type="number" min="1" max="5" placeholder="Innovation" id="innovation">
  <input type="number" min="1" max="5" placeholder="International" id="international">
  <input type="number" min="1" max="5" placeholder="Research" id="research">
  <input type="number" min="1" max="5" placeholder="Infrastructure" id="infrastructure">
  <input type="number" min="1" max="5" placeholder="Sports" id="sports">
  <input type="number" min="1" max="5" placeholder="Food" id="food">
  <input type="number" min="1" max="5" placeholder="Environment" id="environment">
  <button class="btn" id="addSchool">Add</button>
</div>

<div id="results"></div>
<canvas id="rankingChart"></canvas>

<script>
const weights = {
  Scholarship: 10,
  "Academic Quality": 9,
  "Employment Opportunities": 8,
  Innovation: 8,
  International: 2,
  Research: 7,
  Infrastructure: 8,
  Sports: 5,
  Food: 5,
  Environment: 10
};

let schools = [];
let chart = null;
let customSchool = null;

// Load CSV
async function loadCSV() {
  const response = await fetch("data.csv");
  const text = await response.text();
  const lines = text.trim().split("\n");
  const headers = lines[0].split(",");
  schools = lines.slice(1).map(line => {
    const values = line.split(",");
    const obj = {};
    headers.forEach((h,i) => {
      const key = h.trim();
      const value = values[i]?.trim();
      obj[key] = isNaN(value) ? value : Number(value);
    });
    return obj;
  });
  displayResults();
}

// Calculate weighted score (0-500)
function calculateScore(school) {
  let total = 0, weightSum = 0;
  for (let key in weights) {
    if (school[key] !== undefined && !isNaN(school[key])) {
      total += school[key] * weights[key];
      weightSum += weights[key];
    }
  }
  return (total / weightSum) * 500;
}

// Display ranking table & chart
function displayResults() {
  schools.forEach(s => s.Score = calculateScore(s));
  schools.sort((a,b) => b.Score - a.Score);

  // Table
  let html = `<h2>Ranking (${schools.length} Schools)</h2>
    <table><tr><th>Rank</th><th>School</th><th>Score</th></tr>`;
  schools.forEach((s,i) => {
    const highlight = s === customSchool ? "style='background:#d1f5d3;font-weight:bold;'" : "";
    html += `<tr ${highlight}><td>${i+1}</td><td>${s.School}</td><td>${s.Score.toFixed(2)}</td></tr>`;
  });
  html += "</table>";
  document.getElementById("results").innerHTML = html;

  // Chart with 5 bars
  const ranges = [
    {label:"0-99", min:0, max:99},
    {label:"100-200", min:100, max:200},
    {label:"201-300", min:201, max:300},
    {label:"301-400", min:301, max:400},
    {label:"401-500", min:401, max:500}
  ];

  const counts = ranges.map(r => schools.filter(s => s.Score >= r.min && s.Score <= r.max).length);

  const colors = ranges.map(r => {
    if(customSchool && customSchool.Score >= r.min && customSchool.Score <= r.max) return "#4CAF50";
    return "#2196F3";
  });

  const ctx = document.getElementById("rankingChart").getContext("2d");
  if(chart) chart.destroy();
  chart = new Chart(ctx, {
    type:"bar",
    data:{ labels: ranges.map(r=>r.label), datasets:[{label:"Number of Schools", data:counts, backgroundColor:colors}] },
    options:{ responsive:true, plugins:{legend:{display:false}, title:{display:true,text:"Schools Distribution by Score"}}, scales:{y:{beginAtZero:true, stepSize:1}}}
  });
}

// Add 51st school
document.getElementById("addSchool").addEventListener("click", () => {
  customSchool = {
    School: document.getElementById("schoolName").value || "Custom School",
    Scholarship: +document.getElementById("scholarship").value,
    "Academic Quality": +document.getElementById("academic").value,
    "Employment Opportunities": +document.getElementById("employment").value,
    Innovation: +document.getElementById("innovation").value,
    International: +document.getElementById("international").value,
    Research: +document.getElementById("research").value,
    Infrastructure: +document.getElementById("infrastructure").value,
    Sports: +document.getElementById("sports").value,
    Food: +document.getElementById("food").value,
    Environment: +document.getElementById("environment").value
  };
  schools.push(customSchool);
  displayResults();
});

// Initialize
loadCSV();
</script>

</body>
</html>
